<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>my test site</title>
</head>
<body>
    <div id="my_bed_Chart" style="margin-left: 20px;"></div>
<script>
    beds_and_cots_getData();
    var f_total = 0;
var f_operational = 0;
var num_of_beds = 0;
var num_of_cots = 0;


async function beds_and_cots_getData(){
    const response = await fetch('kmfl.csv');
    const data = await response.text();
    // console.log(data);
    
    
    const rows = data.split('\n').slice(1);
    rows.forEach(elt => {
        const row = elt.split(',')
        const Code = row[0];
        // xlabels.push(Code);
        const Name = row[1];
        const beds = row[10];
        const cots = row[11];
        const operation = row[16];
        const Keph_level = row[4];
        const County = row[12];
        
        const Sub_county = row[14];
        const Ward = row[15];
    
    
                f_total = f_total + 1;
                //increment cots
                if(isNaN(cots)){
                   
                 }else{
                    num_of_cots = num_of_cots + parseInt(cots) ;
                 }
                 //increment operational facilities
                 if(operation == "Operational")
                 {
                    f_operational = f_operational + 1;
                 }
                
                 //increment beds
                 if(isNaN(beds)){
                   
                 }else{
                    num_of_beds = num_of_beds + parseInt(beds);
                 }
        
    })

    var beds_cots_max = num_of_beds;
            if(num_of_cots > beds_cots_max)
            {
              beds_cots_max = num_of_cots;
            }
            else{

            }

            beds_cots_max = beds_cots_max + 1;
            beds_cots_max = Math.ceil((beds_cots_max )/ 10) * 10;


  var title_name;
  var y_axis_text ="Number of Beds and cots";

     title_name = "Number of Beds and Cots in All  <br> Facilities in Kenya ";
  
    var chartData = {
    type: 'bar',
    "title":{  
        "text": title_name  
        }, 
        "scale-y":{ 
          'min-value': 0,
          'max-value': beds_cots_max, 
            label: { // Scale Title 
            text: y_axis_text,
            },
            "items-overlap":true,  
            "item":{  
                "font-angle":-90,
                 "offset-x":"7px"
                }
            
            },
        "scale-x":{  
            label: { // Scale Title 
            text: "Bed and cots in "+f_operational+" Operational facilities"
            },
            labels: ["Beds", "Cots"]
            },
    series: [
        { 
            values: [num_of_beds, num_of_cots],
            'background-color': "#6666FF"
        },
    ]
    };
    zingchart.render({
    id: 'my_bed_Chart',
    data: chartData,
    width: "80%"
    });

    }
</script>
</body>
</html>